# API Specification

The design of Micro25519 is based on a layered architecture consisting of four main layers. These four layers represent a hierarchy where each layer depends (mostly) on functions provided by the next-lower layer but may also use operations from layers further down.

- The lowest layer includes all basic _Multi-Precision Integer (MPI)_ and _prime-field arithmetic_ operations needed by X25519 and Ed25519. Important examples of the latter are addition, subtraction, multiplication, squaring, and inversion modulo the pseudo-Mersenne prime $p = 2^{255} - 19$, all of which significantly impact overall execution time. The MPI operations include, besides basic operations like addition and multiplication, also various auxiliary operations for setting an MPI to a specific value, comparing two MPIs, shifting an MPI, converting an MPI to a hex-string for printing, etc. Most of the C functions for these low-layer operations are leaf functions, i.e., they do not call any other function.

- The next-higher layer covers operations for the _addition and doubling of points_ on an elliptic curve, which is either the Montgomery curve [Curve2559](https://datatracker.ietf.org/doc/html/rfc7748#section-4.1) or the birationally-equivalent Twisted Edwards (TED) curve [Edwards25519](https://datatracker.ietf.org/doc/html/rfc8032#section-5). As is common practice, the points on the Montgomery curve are represented in projective [[X:Z] coordinates](http://hyperelliptic.org/EFD/g1p/auto-montgom-xz.html), and the point-addition is a "differential" addition. On the other hand, the point-addition on the TED curve is a "mixed" addition where one of the points is given in [extended projective coordinates](http://www.hyperelliptic.org/EFD/g1p/auto-twisted-extended.html). Apart from point addition/doubling, this layer includes operations for mapping points between the Montgomery and TED representation, and operations to convert points between affine, projective, and extended projective coordinates.

- Above the point-arithmetic layer is the layer for _scalar multiplication_ on both the Montgomery curve and the birationally-equivalent TED curve. Three different variants are supported: (i) variable-base  scalar multiplication $k \cdot P$ on the Montgomery curve, (ii) fixed-base scalar multiplication $l \cdot G$ on the TED curve, and (iii) double-scalar multiplication $l \cdot G - k \cdot P$ on the TED curve. However, thanks to the birational equivalence between the two curve models, the result of the fixed-base scalar multiplication can be mapped to a point on the Montgomery curve and the result of the variable-base scalar multiplication to a point on the TED curve. In this way, it becomes possible to compose the double-scalar multiplication of two individual scalar multiplications, a variable-base one on the Montgomery curve and a fixed-base one in the TED curve.

- The highest layer covers the basic operations for _[X25519](https://cr.yp.to/ecdh.html) key exchange_ and the _[Ed25519](https://ed25519.cr.yp.to) signature scheme_, respectively. In the former case, these operations are the generation of a key-pair (involving a fixed-based scalar multiplication) and the derivation of a shared secret (variable-base scalar multiplication). On the other hand, Ed25519 consists of three basic operations: (i) the generation of a key-pair (fixed-base), (ii) signature generation (fixed-base), and (iii) signature verification (double-scalar). Furthermore, Ed25519 requires some extra operations, such as decompression of a public key in compressed form, which involves an exponentiation in the underlying field.

This directory contains the documentation of the API of Micro25519 in six markdown files, roughly following the hierarchy described above. The API was designed to facilitate the reuse of operations across X25519 and Ed25519. For example, the double-scalar multiplication $l \cdot G - k \cdot P$ is composed of a fixed-base scalar multiplication $l \cdot G$ and a variable-base scalar multiplication $k \cdot P$. The latter is actually performed on the Montgomery curve, but embedded into a TED-Montgomery mapping before and a Montgomery-TED mapping thereafter, taking into account some [corner cases](https://orbilu.uni.lu/handle/10993/49970). This approach reduces both the code-size and RAM footprint compared to more performance-optimized implementation options (e.g., interleaving) at the expense of a slight performance penalty.

- The markdown files [mpiarith.md](./mpiarith.md) and [gfparith.md](./gfparith.md) specify the API of the low-level MPI and field-arithmetic functions, respectively.

- The markdown files [moncurve.md](./moncurve.md) and [tedcurve.md](./tedcurve.md) specify the API of the medium-level point-arithmetic and scalar multiplication functions for the Montgomery and TED curve, respectively.

- The markdown files [x25519.md](./x25519.md) and [ed25519.md](./ed25519.md) specify the API of the high-level functions for X25519 key exchange and Ed25519 signature generation/verification, respectively.

These six markdown files roughly reflect the structure of the source code, since, for example, the point-arithmetic functions for the Montgomery and TED curves are contained in two separate C files. The high-level functions for X25519 and Ed25519 also come in their own C file. However, the C file for Ed25519 also includes some signature-specific low-level functions for field and point arithmetic, respectively, to support modularity. For example, a user who only needs X25519 can simply remove this C file from the project to eliminate all Ed25519-related functions without having to modify any other C file.
